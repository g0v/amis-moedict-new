<div class="flex items-center space-x-2">
  <h1 class="text-2xl">
    <%= params[:id] %>
    <% if @terms.first.is_stem %>
      <span class="text-base">（詞幹）</span>
    <% end %>
  </h1>
</div>
<div class="mt-4 space-y-4">
  <% @terms.each do |term| %>
    <div>
      <div class="bg-<%= term.dictionary.color %>-600 text-white p-2"><%= term.dictionary.name %></div>
      <% if term.descriptions.present? %>
        <div>
          <% if term.repetition.present? %>
            <span class="bg-rose-600 text-white p-0.5">
              [疊 <%= term.repetition %>]
            </span>
          <% end %>

          <% stem = term.stem %>
          <% if stem.present? %>
            <span class="text-gray-500">
              （詞幹: <%= link_to(stem.name, term_path(stem.name)) %>）
            </span>
          <% end %>
          
          <% if term.audio.present? %>
            <button>
              <i class="fas fa-volume-up" onclick="document.getElementById('audio-<%= term.audio_id %>').play()"></i>
            </button>
            <%= audio_tag term.audio, id: "audio-#{term.audio_id}" %>
          <% end %>
        </div>
        <ol class="list-decimal list-outside space-y-2 mt-2 ml-5">
          <% term.descriptions.each do |description| %>
            <li>
              <%= simple_format(description.content) %>
              <% if description.image.present? %>
                <p><%= image_tag description.image, alt: description.content, width: '100' %></p>
              <% end %>
              <% if description.examples.present? %>
                <ul class="list-disc list-inside space-y-1">
                  <% description.examples.each do |example| %>
                    <li>
                      <% content = example.content.gsub("\xEF\xBF\xB9", "") %>
                      <% parts = content.split(/[`~]/).reject(&:empty?) %>
                      <%== parts.each_with_index.map do |part, i|
                            if part.match(/^[\p{Alnum}]+$/) && part != params[:id]
                              term_path = if i == 0
                                            "/terms/#{part.downcase}"
                                          else
                                            "/terms/#{part}"
                                          end

                              "<a href=\"#{term_path}\" class=\"border-b border-gray-300 text-gray-800 hover:bg-gray-300 focus:bg-gray-300 hover:text-[#0070a3] focus:text-[#0070a3] focus:outline focus:outline-1 focus:outline-[#69d2fc]\">#{part}</a>"
                            else
                              part
                            end
                          end.join %>
                    </li>
                  <% end %>
                </ul>
              <% end %>
            </li>
          <% end %>
          <!-- <li>捉獵物，獵獲的（獵物）。
            <p>O 'adopen niyam a <span class="relative group"><span class="underline">fafoy</span><span class="absolute bg-gray-200 p-1 border rounded hidden group-hover:block">fafoy<br>野豬。</span></span>。</p>
          </li> -->
        </ol>
      <% end %>
    </div>
  <% end %>
</div>
